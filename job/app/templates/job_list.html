<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job List</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <style>
        /* General Theme */
        body {
            background-color: #f8f9fa;
            color: #333;
            padding-bottom: 100px; /* Adjust this value based on the footer height */
        }
        /* Navbar */
        .navbar {
            background-color: #007bff;
        }
        .navbar-brand, .nav-link {
            color: white !important;
        }
        /* Profile Sidebar */
        .profile-sidebar {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100%;
            background: white;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
            transition: right 0.3s ease-in-out;
            padding: 20px;
            z-index: 1050;
            border-left: 4px solid #007bff;
            text-align: center;
        }
        .profile-header {
            font-weight: bold;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            color: #333;
            cursor: pointer;
        }
        /* Profile Picture */
        .profile-pic-container {
            position: relative;
            width: 180px;
            height: 200px;
            margin: 0 auto;
        }
        .profile-pic {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid #007bff;
            object-fit: cover;
        }
        .edit-icon {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: #007bff;
            color: white;
            padding: 5px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
        }
        /* SVG Default Profile */
        .default-profile {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        .edit-profile-btn, .edit-password-btn {
            margin-top: 15px;
            width: 80%;
        }
        .edit-password-link {
            color: blue;
            cursor: pointer;
        }
        /* Profile Info */
        .profile-info {
            font-size: 1.1rem;
            margin-top: 10px;
            text-align: left;
        }
        .profile-info strong {
            color: #007bff;
        }
        /* Job Table */
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        /* Job Cards */
.job-card {
    margin-bottom: 20px;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
}

.job-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card-body {
    animation: fadeIn 1s ease-in-out;
}/* Add styles for search bar and button spacing */
.input-group .form-control {
    width: 70%;
}

.input-group .btn {
    margin-left: 10px;
}
html, body {
    height: 100%;
    margin: 0;
    display: flex;
    flex-direction: column;
}

.container {
    flex: 1; /* Pushes footer to the bottom */
}

footer {
    margin-top: auto;
}
footer {
    width: 100%;
    left: 0;
    bottom: 0;
}
footer {
    width: 100vw; /* Ensures the footer spans the full viewport width */
    position: relative; /* Or 'fixed' if you want it always at the bottom */
    left: 0;
    bottom: 0;
    background-color: #343a40; /* Ensure it's styled properly */
    color: white;
    text-align: center;
}
#jobList {
    min-height: 300px; /* Adjust as needed */
}

.banner {
    background: linear-gradient(to right, #ffffff 50%, #f0f8ff 100%);
    padding: 40px 0;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    border: 1px solid #e6e6e6;
}

.banner-title {
    font-weight: 800;
    color: #2c3e50;
    font-size: 2.5rem;
    margin-bottom: 20px;
}

.banner-text {
    color: #5d6d7e;
    font-size: 1.1rem;
    margin-bottom: 30px;
}

.banner-btn {
    background-color: #3498db;
    border: none;
    padding: 12px 30px;
    font-weight: 600;
    border-radius: 30px;
    box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
    transition: all 0.3s ease;
}

.banner-btn:hover {
    background-color: #2980b9;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
}

.image-container {
    position: relative;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.banner-image {
    max-width: 100%;
    border-radius: 10px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transition: transform 0.5s ease;
}

.banner-image:hover {
    transform: scale(1.03);
}

.highlight {
    color: #3498db;
}

.company-logos {
    margin-top: 20px;
    opacity: 0.7;
}



.profile-sidebar {
    position: fixed;
    top: 0;
    right: -350px; /* Hide sidebar by default */
    width: 350px;
    height: 100vh;
    background-color: #fff;
    box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
    transition: right 0.3s ease;
    overflow-y: auto; /* Make it scrollable */
    z-index: 1000;
}

.profile-content {
    padding: 20px;
}

.profile-header {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 20px;
}

.profile-info {
    margin-bottom: 20px;
}

.profile-info p {
    margin: 10px 0;
}

.profile-pic-container {
    text-align: center;
    margin-bottom: 20px;
}

.profile-pic {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
}

.default-profile {
    width: 100px;
    height: 100px;
    margin: 0 auto;
}

.progress {
    height: 20px;
    margin-bottom: 20px;
}

.progress-bar {
    background-color: #28a745;
}

.edit-profile-btn, .edit-password-link {
    display: block;
    width: 100%;
    margin-bottom: 10px;
    text-align: center;
}

.edit-password-link {
    color: #007bff;
    cursor: pointer;
    text-decoration: underline;
}

{% comment %} new side bar {% endcomment %}
/* Sidebar styling */
.sidebar {
    position: fixed;
    top: 0;
    left: -320px;
    width: 320px;
    height: 100%;
    background-color: #f8f9fa;
    transition: all 0.3s;
    z-index: 1050;
    overflow-y: auto;
    box-shadow: 3px 0 10px rgba(0,0,0,0.1);
    padding: 20px;
}

.sidebar.active {
    left: 0;
}

.sidebar-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 1040;
    display: none;
}

.profile-image-container {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto 10px;
}

.profile-image {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #dee2e6;
}

/* Circular Profile Completion Indicator */
.profile-completion {
    position: absolute;
    top: -5px;
    left: -5px;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    border-radius: 50%;
    border: 5px solid transparent;
    transition: all 0.5s ease-in-out;
}

/* Profile Completion Animation */
@keyframes progressRotate {
    from { transform: rotate(-90deg); }
    to { transform: rotate(calc(270deg * var(--progress))); }
}



.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
    font-size: 20px;
}

.field-row {
    margin-bottom: 10px;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 10px;
}

.field-label {
    font-weight: bold;
    color: #6c757d;
}

.field-value {
    font-weight: normal;
}

.edit-form .form-control {
    margin-bottom: 10px;
}


    </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">Job Portal</a>
        <div class="ml-auto">
            {% if user.is_authenticated %}
           <a href="{% url 'api_jobs' %}" style="color:white;px-2">Jobs</a>
            <a href="#" id="profile-btn" class="btn btn-outline-light me-2 d-inline-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="me-1">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
                Profile
              </a>
                <form action="{% url 'logout' %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Logout</button>
                </form>
            {% else %}
            {% csrf_token %}
                <a href="{% url 'login' %}" class="btn btn-outline-light me-2">Login</a>
                <a href="{% url 'signup' %}" class="btn btn-light">Signup</a>
            {% endif %}
        </div>
    </div>
</nav>

{% comment %} banner {% endcomment %}
  <div class="container pt-3 pb-2">
    <!-- Attractive Banner Container -->
    <div class="banner">
        <div class="container">
            <div class="row align-items-center">
                <!-- Left side: Text content -->
                <div class="col-lg-6 col-md-12">
                    <h1 class="banner-title">Find Your <span class="highlight">Dream Job</span> Today</h1>
                    <p class="banner-text">Connect with top employers and discover opportunities that match your skills and career goals. Join thousands of successful job seekers!</p>
                    <button class="btn banner-btn btn-primary btn-lg">Explore Opportunities</button>
                    
                    <div class="company-logos d-none d-lg-block">
                        <small class="text-muted d-block mb-2">Trusted by leading companies</small>
                        {% comment %} <img src="/api/placeholder/280/30" alt="Company logos" class="img-fluid"> {% endcomment %}
                    </div>
                </div>
                
                <!-- Right side: Attractive image -->
                <div class="col-lg-6 col-md-12">
                    <div class="image-container">
                        {% load static %}
                        <img src="{% static 'images/Banner.jpg' %}" alt="Professional team in an office meeting" class="banner-image img-fluid" style="width: 100%; height: 300px; object-fit: cover;">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<pre>{{ user }}</pre>


<!-- Sidebar Backdrop -->
<div class="sidebar-backdrop" id="sidebar-backdrop"></div>

<!-- Profile Sidebar -->
<div class="sidebar" id="profile-sidebar">
    <div class="close-btn" id="close-sidebar">&times;</div>
    
    <!-- View Profile Section -->
    <div id="view-profile">
        <div class="profile-image-container">
            <img id="profile-picture" src="/static/images/default-profile.png" class="img-fluid rounded-circle">
            <div class="profile-completion" id="profile-completion"></div>
        </div>
        <!-- Profile Completion Text Below Image -->
        <p id="profile-completion-text" class="text-center mt-2 fw-bold" style="font-size: 16px; color: #198754;">0%</p>
        
        
        
        
        <h4 class="text-center mb-4" id="profile-name"></h4>
        
        <div class="field-row">
            <span class="field-label">Email:</span>
            <span class="field-value" id="email-value"></span>
        </div>
        
        <div class="field-row">
            <span class="field-label">Father's Name:</span>
            <span class="field-value" id="father-name-value"></span>
        </div>
        
        <div class="field-row">
            <span class="field-label">UG College:</span>
            <span class="field-value" id="ug-college-value"></span>
        </div>
        
        <div class="field-row">
            <span class="field-label">Branch:</span>
            <span class="field-value" id="branch-value"></span>    
        </div>
        
        <div class="field-row">
            <span class="field-label">Passout Year:</span>
            <span class="field-value" id="passout-year-value"></span>
        </div>
        
        <div class="field-row">
            <span class="field-label">Graduation Percentage:</span>
            <span class="field-value" id="grad-percentage-value">}</span>
        </div>
        
        <div class="field-row">
            <span class="field-label">10th Percentage:</span>
            <span class="field-value" id="tenth-percentage-value"></span>
        </div>
{% comment %}         
        <div class="field-row">
            <span class="field-label">12th Percentage:</span>
            <span class="field-value" id="twelth-percentage-value"></span>
        </div> {% endcomment %}

        <button class="btn btn-primary w-100 mt-3" id="edit-profile-btn">Edit Profile</button>
    </div>
    
    <!-- Edit Profile Section (Initially Hidden) -->
    <div id="edit-profile" style="display: none;">
        <h4 class="text-center mb-4">Edit Profile</h4>
        
        <form class="edit-form" id="profile-form">
            <div class="mb-3">
                <label for="profile-pic-input" class="form-label">Profile Picture</label>
                <input type="file" class="form-control" id="profile-pic-input" name="profile_picture" accept="image/*">
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
            
            <div class="mb-3">
                <label for="name-input" class="form-label">Name</label>
                <input type="text" class="form-control" id="name-input" name="name" value="">
            </div>
            
            <div class="mb-3">
                <label for="email-input" class="form-label">Email</label>
                <input type="email" class="form-control" id="email-input" name="email" value="">
            </div>
            
            <div class="mb-3">
                <label for="father-name-input" class="form-label">Father's Name</label>
                <input type="text" class="form-control" id="father-name-input" name="father_name" value="">
            </div>
            
            <div class="mb-3">
                <label for="ug-college-input" class="form-label">UG College</label>
                <input type="text" class="form-control" id="ug-college-input" name="ug_college" value="">
            </div>
            
            <div class="mb-3">
                <label for="branch-input" class="form-label">Branch</label>
                <input type="text" class="form-control" id="branch-input" name="branch" value="">
            </div>
            
            <div class="mb-3">
                <label for="passout-year-input" class="form-label">Passout Year</label>
                <input type="text" class="form-control" id="passout-year-input" name="passout_year" value="">
            </div>
            
            <div class="mb-3">
                <label for="grad-percentage-input" class="form-label">Graduation Percentage</label>
                <input type="text" class="form-control" id="grad-percentage-input" name="graduation_percentage" value="">
            </div>
            
            <div class="mb-3">
                <label for="tenth-percentage-input" class="form-label">10th Percentage</label>
                <input type="text" class="form-control" id="tenth-percentage-input" name="tenth_percentage" value="">
            </div>
            
            {% comment %} <div class="mb-3">
                <label for="twelth-percentage-input" class="form-label">12th Percentage</label>
                <input type="text" class="form-control" id="twelth-percentage-input" name="twelfth_percentage" value="">
            </div> {% endcomment %}
            
             <div class="d-flex gap-2">
                <button type="button" class="btn btn-secondary flex-grow-1" id="cancel-edit-btn">Cancel</button>
                <button type="submit" class="btn btn-success flex-grow-1" id="save-profile-btn">Save</button>
            </div>
        </form>
    </div>
    
    </div>
</div>



<!-- Job List Section -->
<div class="container mt-4">
    <div class="table-container">
        <h2 class="text-center mb-4 text-primary fw-bold display-4">Available Jobs</h2>



        <!-- Search Bar -->
        <div class="input-group mb-3" style="max-width: 500px; margin: auto;">
            <input type="text" id="jobSearch" class="form-control" placeholder="Search for jobs..." style="width: 70%;">
            <button class="btn btn-primary" type="button" id="searchButton" style="margin-left: 10px;">Search</button>
        </div>

        <!-- Job Filters -->
        <!-- Job Filters (Responsive) -->
        <div class="container">
            <div class="row g-2 justify-content-center align-items-center">
                <div class="col-12 col-sm-6 col-md-3">
                    <select id="jobRole" class="form-select w-100">
                        <option value="">Job Role</option>
                        <option value="Frontend Developer">Frontend Developer</option>
                        <option value="Data Analyst">Data Analyst</option>
                        <option value="UI">UI</option>
                        <option value="Backend Developer">Backend Developer</option>
                    </select>
                </div>
        
                <div class="col-12 col-sm-6 col-md-3">
                    <select id="jobType" class="form-select w-100">
                        <option value="">Job Type</option>
                        <option value="Full Time">Full Time</option>
                        <option value="Part Time">Part Time</option>
                    </select>
                </div>
        
                <div class="col-12 col-sm-6 col-md-3">
                    <select id="jobLocation" class="form-select w-100">
                        <option value="">Location</option>
                        <option value="Bengaluru">Bengaluru</option>
                        <option value="Pune">Pune</option>
                        
                    </select>
                </div>
        
                <!-- Experience dropdown and Apply button in the same row for desktop -->
                <div class="col-12 col-sm-6 col-md-3 d-flex flex-column flex-md-row align-items-md-center">
                    <select id="jobExperience" class="form-select w-100 mb-2 mb-md-0 me-md-2">
                        <option value="">Experience</option>
                        <option value="0-1">0-1 Years</option>
                        <option value="1-2">1-2 Years</option>
                        <option value="0-5">0-5 Years</option>
                    </select>
                    <div class="d-flex flex-column flex-md-row gap-2">
                        <button class="btn btn-sm btn-primary w-100 w-md-auto" id="filterButton">Apply</button>
                        <button class="btn btn-sm btn-danger w-100 w-md-auto" id="removeFilterButton">Remove</button>
                    </div>
                </div>
            </div>
        </div>
        
       <!-- Job List Section -->
<div class="row justify-content-center mb-4 mt-4" id="jobListContainer">
    <div id="jobList" class="row">
        {% for job in jobs %}
            <div class="col-md-4 col-sm-6 mb-4 job-card" data-role="{{ job.Job }}" data-type="{{ job.Type }}" data-location="{{ job.Location }}" data-experience="{{ job.Experience }}">
    
            <div class="card shadow-lg h-90 border-0 rounded-4 hover:shadow-xl transition border-start border-primary border-4 mb-2 my-2">
                <div class="card-body d-flex flex-column p-3">
                    <h5 class="card-title fw-bold text-primary">{{ job.Job }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ job.Org }}</h6>
                    <p class="card-text mb-3">
                        <strong>üìç Location:</strong> {{job.Location}}<br>
                        <strong>üí∞ Salary:</strong> ‚Çπ{{ job.Salary }} LPA<br>
                        <strong>üîπ Experience:</strong> 0 - 5 Years
                    </p>
                    <div class="mb-3">
                        <strong>üõ† Skills:</strong>
                        {% for skill in job.Skills %}
                            <span class="badge bg-secondary">{{ skill }}</span>
                        {% endfor %}
                    </div>
                    <div class="mb-3">
                        <strong>üè¢ Type:</strong>
                        <span class="badge bg-info">{{job.Type}}</span>
                    </div>
                    <p class="text-muted text-truncate" style="max-height: 60px; overflow: hidden;">
                        {{ job.FullDescription }}
                    </p>
                    <div class="mt-auto">
                        {% if job.Job in applied_jobs %}
                            <button class="btn btn-success w-100 fw-bold" disabled>‚úî Applied</button>
                        {% else %}
                            <button class="btn btn-primary w-100 fw-bold apply-btn" data-job-id="{{ job.Job }}">
                                Apply Now
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Pagination Section -->
<div class="pagination-container text-center mt-4">
    <button class="btn btn-secondary me-2" id="prevPage">¬´ Prev</button>
    <span id="paginationNumbers"></span>
    <button class="btn btn-secondary ms-2" id="nextPage">Next ¬ª</button>
</div>

</div>
</div>

<!-- Footer Section -->
<footer class="bg-dark text-light py-4 mt-3 mb-0 w-100">
    <div class="container-fluid">
        <div class="row">
            <!-- Company Info -->
            <div class="col-md-4">
                <h5>Job Portal</h5>
                <p>Your trusted platform for finding and applying for the best job opportunities.</p>
            </div>
            
            <!-- Quick Links -->
            <div class="col-md-4">
                <h5>Quick Links</h5>
                <ul class="list-unstyled">
                    <li><a href="#" class="text-light text-decoration-none">Home</a></li>
                    <li><a href="#" class="text-light text-decoration-none">Jobs</a></li>
                    <li><a href="#" class="text-light text-decoration-none">About Us</a></li>
                    <li><a href="#" class="text-light text-decoration-none">Contact</a></li>
                </ul>
            </div>
            
            <!-- Contact Info -->
            <div class="col-md-4">
                <h5>Contact Us</h5>
                <p>Email: support@jobportal.com</p>
                <p>Phone: +91 12345 67890</p>
                <div>
                    <a href="#" class="text-light me-2"><i class="fab fa-facebook fa-lg"></i></a>
                    <a href="#" class="text-light me-2"><i class="fab fa-twitter fa-lg"></i></a>
                    <a href="#" class="text-light"><i class="fab fa-linkedin fa-lg"></i></a>
         
       </div>
            </div>
        </div>
        
        <!-- Copyright -->
        <div class="text-center mt-3">
            <p class="mb-0">&copy; 2025 Job Portal. All rights reserved.</p>
        </div>
    </div>
</footer>

<!-- FontAwesome for icons -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    
    

    $(document).ready(function(){
        $("#removeFilterButton").on("click", function() {
            location.reload(); // Refresh the page to remove filters
        });
        
        // Search Filter
        function filterJobs() {
            var value = $("#jobSearch").val().toLowerCase();
            $(".job-card").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        }

        $("#searchButton").on("click", function() {
            filterJobs();
        });$(document).ready(function() {
            $("#searchButton").on("click", function() {
                var value = $("#jobSearch").val().toLowerCase();
                var jobsFound = false;
        
                $(".job-card").each(function() {
                    var match = $(this).text().toLowerCase().indexOf(value) > -1;
                    $(this).toggle(match);
                    if (match) jobsFound = true;
                });
        
                // Show "Job Not Found" message dynamically if no jobs match
                if (!jobsFound) {
                    $("#jobList").html('<div class="text-center text-danger fw-bold mt-3 h5"> No Jobs Found </div>');
                }
            });
        });


        $("#filterButton").on("click", function() {
            var selectedRole = $("#jobRole").val();
            var selectedType = $("#jobType").val();
            var selectedLocation = $("#jobLocation").val();
            var selectedExperience = $("#jobExperience").val();
            var jobsFound = false;

            $(".job-card").each(function() {
                var jobRole = $(this).data("role");
                var jobType = $(this).data("type");
                var jobLocation = $(this).data("location");
                var jobExperience = $(this).data("experience") || ""; // Handle empty cases

                var showJob = true;

                if (selectedRole && jobRole !== selectedRole) {
                    showJob = false;
                }
                if (selectedType && jobType !== selectedType) {
                    showJob = false;
                }
                if (selectedLocation && jobLocation !== selectedLocation) {
                    showJob = false;
                }
                if (selectedExperience) {
                    let expRange = selectedExperience.split("-").map(Number);
                    let jobExpRange = jobExperience.split("-").map(Number);

                    if (!(jobExpRange[0] >= expRange[0] && jobExpRange[1] <= expRange[1])) {
                        showJob = false;
                    }
                }

                $(this).toggle(showJob);
                if (showJob) jobsFound = true;
            });

            // Show "No Jobs Found" message only if no jobs match
            if (!jobsFound) {
                $("#jobList").html('<div class="text-center text-danger fw-bold mt-3 h5"> No Jobs Found </div>');
            }
        });

       
        
        
        // Apply Button Functionality
        $(".apply-btn").on("click", function() {
            var button = $(this);
            var jobId = button.data("job-id");
            
            $.ajax({
                url: "{% url 'toggle_apply_job' %}",
                method: "POST",
                data: {
                    job_id: jobId,
                    csrfmiddlewaretoken: "{{ csrf_token }}"
                },
                success: function(response) {
                    if (response.status === "applied") {
                        button.text("Applied");
                        button.removeClass("btn-primary").addClass("btn-success");
                    } else {
                        button.text("Apply");
                        button.removeClass("btn-success").addClass("btn-primary");
                    }
                },
                error: function() {
                    alert("Error applying for job. Please try again.");
                }
            });
        });
    });

    // Pagination
    $(document).ready(function () {
        var jobsPerPage = 4;
        var currentPage = 1;
        var jobCards = $(".job-card");
        var totalPages = Math.ceil(jobCards.length / jobsPerPage);

        function showPage(page) {
            jobCards.hide();
            jobCards.slice((page - 1) * jobsPerPage, page * jobsPerPage).show();
            $("#paginationNumbers").html(generatePaginationNumbers(page, totalPages));
        }

        function generatePaginationNumbers(current, total) {
            var paginationHtml = '';
            for (var i = 1; i <= total; i++) {
                paginationHtml += `<button class="btn ${i === current ? 'btn-primary' : 'btn-outline-primary'} page-btn" data-page="${i}">${i}</button> `;
            }
            return paginationHtml;
        }

        // Initial Page Load
        showPage(currentPage);

        // Pagination Click Event
        $(document).on("click", ".page-btn", function () {
            currentPage = parseInt($(this).data("page"));
            showPage(currentPage);
        });

        // Previous and Next Button Events
        $("#prevPage").on("click", function () {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        });

        $("#nextPage").on("click", function () {
            if (currentPage < totalPages) {
                currentPage++;
                showPage(currentPage);
            }
        });
    });

   
    document.addEventListener('DOMContentLoaded', function() {
        const profileBtn = document.getElementById('profile-btn');
        const sidebar = document.getElementById('profile-sidebar');
        const backdrop = document.getElementById('sidebar-backdrop');
        const closeBtn = document.getElementById('close-sidebar');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const viewProfileSection = document.getElementById('view-profile');
        const editProfileSection = document.getElementById('edit-profile');
        const profileForm = document.getElementById('profile-form');
        const profileCompletion = document.getElementById('profile-completion');
        const profileImg = document.getElementById('profile-picture');
    
        {% comment %} function fetchUserData() {
            fetch('/user_list/')
                .then(response => response.json())
                .then(data => {
                    if (data.user_data) {
                        populateViewProfile(data.user_data);
                    }
                });
        }
     {% endcomment %}
     
        function populateViewProfile(userData) {
            document.getElementById('profile-name').textContent = userData.user_name;
            document.getElementById('email-value').textContent = userData.email;
            document.getElementById('father-name-value').textContent = user.father_name;
            document.getElementById('ug-college-value').textContent = userData.ug_college;
            document.getElementById('branch-value').textContent = userData.branch;
            document.getElementById('passout-year-value').textContent = userData.passout_year;
            document.getElementById('grad-percentage-value').textContent = userData.grad_percentage + '';
            document.getElementById('tenth-percentage-value').textContent = userData.tenth_percentage + '';
            document.getElementById('twelth-percentage-value').textContent = userData.twelfth_percentage + '';
    
            {% comment %} updateProfileCompletion(userData); {% endcomment %}
        }
        function fetchUserData() {
            fetch('/get_user_profile/')
                .then(response => response.json())
                .then(data => {
                    console.log("Fetched Data:", data); // Debugging line
                    if (data.success && data.data.length > 0) {
                        const userData = data.data[0]; // Extract first element
                        populateViewProfile(userData);
                        populateEditForm(userData);
                        updateProfileCompletion(userData);
                    } else {
                        console.error('Failed to fetch user data');
                    }
                })
                .catch(error => console.error('Error fetching user data:', error));
        }
        // Open sidebar
        profileBtn.addEventListener('click', function() {
            sidebar.classList.add('active');
            backdrop.style.display = 'block';
            fetchUserData();
        });
    
        // Close sidebar
        function closeSidebar() {
            sidebar.classList.remove('active');
            backdrop.style.display = 'none';
            viewProfileSection.style.display = 'block';
            editProfileSection.style.display = 'none';
        }
    
        closeBtn.addEventListener('click', closeSidebar);
        backdrop.addEventListener('click', closeSidebar);
    
        // Switch to edit mode
        editProfileBtn.addEventListener('click', function() {
            viewProfileSection.style.display = 'none';
            editProfileSection.style.display = 'block';
            fetchUserData(); // Fetch and populate edit form
        });
    
        // Cancel edit
        cancelEditBtn.addEventListener('click', function() {
            viewProfileSection.style.display = 'block';
            editProfileSection.style.display = 'none';
        });
        document.getElementById('profile-form').addEventListener('submit', function (e) {
            e.preventDefault();
        
            let formData = new FormData();  // Create a FormData object
        
            document.querySelectorAll("#profile-form input").forEach(input => {
                if (input.name && input.type !== "file") {
                    formData.append(input.name, input.value.trim());  // Append text fields
                }
            });
        
            // Append profile picture if selected
            let profilePicInput = document.getElementById("profile-pic-input");
            if (profilePicInput.files.length > 0) {
                formData.append("profile_picture", profilePicInput.files[0]);
            }
        
            console.log("Form data being sent:", formData); // Debugging
        
            fetch('/update_profile/', {
                method: 'POST',
                body: formData  // Send FormData (no JSON.stringify)
            })
            .then(response => response.json())
            .then(data => {
                console.log("Server Response:", data); // Debugging
                if (data.status === 'success') {
                    alert("Profile updated successfully!");
                    fetchUserData(); // Refresh profile data
                    document.getElementById('edit-profile').style.display = 'none';
                    document.getElementById('view-profile').style.display = 'block';
                } else {
                    alert("Error updating profile: " + data.message);
                }
            })
            .catch(error => console.error('Fetch Error:', error));
        });
        

        
        
   
        
        function populateViewProfile(userData) {
            document.getElementById('profile-name').textContent = userData.user_name || 'N/A';
            document.getElementById('email-value').textContent = userData.email || 'N/A';
            document.getElementById('father-name-value').textContent = userData.father_name || 'N/A';
            document.getElementById('ug-college-value').textContent = userData.ug_college || 'N/A';
            document.getElementById('branch-value').textContent = userData.branch || 'N/A';
            document.getElementById('passout-year-value').textContent = userData.Passout_Year || 'N/A';
            document.getElementById('grad-percentage-value').textContent = userData.Graduation_Percentage ? userData.Graduation_Percentage.replace(/%+/g, '') : 'N/A';
            document.getElementById('tenth-percentage-value').textContent = userData.Percentage_10 ? userData.Percentage_10.replace(/%+/g, '') : 'N/A';
            console.log("Full Profile Picture Data:", userData.profile_picture);
            profileImage = document.getElementById("profile-picture");
            profileImage.src = `data:image/jpeg;base64, ${userData.profile_picture}`;

            

            {% comment %} document.getElementById('twelfth-percentage-value').textContent = userData.Percentage_12 ? userData.Percentage_12 + '' : 'N/A'; {% endcomment %}
        }
        
        function populateEditForm(userData) {
            try {
                console.log("Populating form with:", userData);
                document.getElementById('name-input').value = userData.user_name || '';
                document.getElementById('email-input').value = userData.email || '';
                document.getElementById('father-name-input').value = userData.father_name || '';
                document.getElementById('ug-college-input').value = userData.ug_college || '';
                document.getElementById('branch-input').value = userData.branch || '';
                document.getElementById('passout-year-input').value = userData.Passout_Year || 'N/A';
                document.getElementById('grad-percentage-input').value = userData.Graduation_Percentage ? userData.Graduation_Percentage.replace(/%+/g, '') : 'N/A';
document.getElementById('tenth-percentage-input').value = userData.Percentage_10 ? userData.Percentage_10.replace(/%+/g, '') : 'N/A';

            } catch (error) {
                console.error("Error populating form:", error);
            }
        }
        
{% comment %}         {% endcomment %}
    });
   


    




    {% comment %} document.addEventListener('DOMContentLoaded', function () {
        const profileBtn = document.getElementById('profile-btn');
        const sidebar = document.getElementById('profile-sidebar');
        const backdrop = document.getElementById('sidebar-backdrop');
        const closeBtn = document.getElementById('close-sidebar');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const profileForm = document.getElementById('profile-form');
    
        function fetchUserData() {
            fetch('/get_user_profile/')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        populateViewProfile(data.user_data);
                        populateEditForm(data.user_data);
                    }
                })
                .catch(error => console.error('Error fetching user data:', error));
        }
    
        function populateViewProfile(userData) {
            document.getElementById('profile-name').textContent = userData.username || 'N/A';
            document.getElementById('email-value').textContent = userData.email || 'N/A';
            document.getElementById('father-name-value').textContent = userData.father_name || 'N/A';
            document.getElementById('ug-college-value').textContent = userData.ug_college || 'N/A';
            document.getElementById('branch-value').textContent = userData.branch || 'N/A';
            document.getElementById('passout-year-value').textContent = userData.passout_year || 'N/A';
            document.getElementById('grad-percentage-value').textContent = userData.grad_percentage + '%' || 'N/A';
            document.getElementById('tenth-percentage-value').textContent = userData.tenth_percentage + '%' || 'N/A';
            document.getElementById('twelfth-percentage-value').textContent = userData.twelfth_percentage + '%' || 'N/A';
        }
    
        function populateEditForm(userData) {
            document.getElementById('name-input').value = userData.username || '';
            document.getElementById('email-input').value = userData.email || '';
            document.getElementById('father-name-input').value = userData.father_name || '';
            document.getElementById('ug-college-input').value = userData.ug_college || '';
            document.getElementById('branch-input').value = userData.branch || '';
            document.getElementById('passout-year-input').value = userData.passout_year || '';
            document.getElementById('grad-percentage-input').value = userData.grad_percentage || '';
            document.getElementById('tenth-percentage-input').value = userData.tenth_percentage || '';
            document.getElementById('twelfth-percentage-input').value = userData.twelfth_percentage || '';
        }
    
        profileBtn.addEventListener('click', function () {
            sidebar.classList.add('active');
            backdrop.style.display = 'block';
            fetchUserData();
        });
    
        closeBtn.addEventListener('click', function () {
            sidebar.classList.remove('active');
            backdrop.style.display = 'none';
        });
    
        cancelEditBtn.addEventListener('click', function () {
            document.getElementById('view-profile').style.display = 'block';
            document.getElementById('edit-profile').style.display = 'none';
        });
    
        profileForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(profileForm);
            
            fetch('/update_profile/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    fetchUserData();
                    document.getElementById('view-profile').style.display = 'block';
                    document.getElementById('edit-profile').style.display = 'none';
                } else {
                    alert(data.message);
                }
            });
        });
    });
     {% endcomment %}


     function updateProfileCompletion(userData) {
        let profileFields = [
            "user_name", "email", "father_name", "ug_college",
            "branch", "passout_year", "Graduation_Percentage",
            "Percentage_10", "Percentage_12", "profile_picture"
        ];
    
        // Count only fields that are actually displayed in the profile sidebar
        let displayedFields = profileFields.filter(field => {
            let element = document.getElementById(`${field.replace(/_/g, "-")}-value`);
            return element !== null; // Ensure the field exists
        });
    
        let totalFields = displayedFields.length; // Use only visible fields
        let filledFields = 0;
    
        displayedFields.forEach(field => {
            let value = userData[field];
    
            // Only count valid (non-"N/A", non-empty) fields
            if (value && value.trim() !== "" && value !== "N/A") {
                filledFields++;
            }
        });
    
        // Ensure completion is accurately calculated
        let completionPercentage = totalFields > 0 ? Math.round((filledFields / totalFields) * 100) : 0;
    
        // Fix: If all displayed fields are filled, ensure it shows 100%
        if (filledFields === totalFields) {
            completionPercentage = 100;
        }
    
        // Update circular progress bar
        let profileCompletion = document.getElementById("profile-completion");
        if (profileCompletion) {
            let rotationAngle = (completionPercentage / 100) * 360 - 90;
    
            // Change color dynamically
            let borderColor = completionPercentage >= 50 ? "#28a745" : "#dc3545"; // Green if > 50%, Red otherwise
            profileCompletion.style.borderTopColor = borderColor;
            profileCompletion.style.borderLeftColor = completionPercentage > 50 ? borderColor : "transparent";
            profileCompletion.style.transform = `rotate(${rotationAngle}deg)`;
        }
    
        // Update percentage text below profile picture
        let completionText = document.getElementById("profile-completion-text");
        if (completionText) {
            completionText.textContent = `${completionPercentage}%`;
            completionText.style.color = completionPercentage >= 50 ? "#28a745" : "#dc3545"; // Match color logic
        }
    
        console.log("Profile Completion Updated:", completionPercentage + "%");
    }

    
    // Call this function after fetching user data
    fetchUserData();
    
    
</script>

</body>
</html>
